---
title: "Econometría Financiera"
subtitle: "Práctica 1: Estimaciones de modelos ARIMA"
author: José Antonio Burgos Francisco
format: 
  pdf:
    message: false
    warning: false
    echo: false
    fig-height: 5
    fig-width: 7
    fig-align: center
    table-of-contents: true
    toc-title: "Índice de contenidos"
    colorlinks: true
    keep-tex: true
---

```{r}
source("functions.R")
source("scripts_reports.R")
library(ggplot2)
library(purrr)
library(dplyr)
library(tibble)
```

\newpage

# Visualización de las Series

## Gráfico1: Series en logaritmos

```{r plot_ipc_log}
base_ipc_longer |>
    plot_ejercicio1(
      var = "log",
      sub_title = "Series en Logaritmos") 
```

## Gráfico 2: Series en primeras diferencias



```{r plot_ipc_diff1}
base_ipc_longer |>
    plot_ejercicio1(
      var = "dif1",
      sub_title = "Series en primeras diferencias")
```

## Gráfico 3: Series en Variación Interanual

```{r plot_ipc_vi}
base_ipc_longer |>
    plot_ejercicio1(
      var = "VI",
      sub_title = "Variación porcentual interanual") 
```

\newpage

# Análisis de Raíz Unitaria

## Prueba Dickey-Fuller Aumentada (ADF).

```{r}
ipc_ts <- ts(
  ipc |> select(-fecha), 
  start = c(2006, 01), 
  frequency = 12) |> 
  as.list()

ipc_log <- map(ipc_ts, log)         # Series en logaritmos
test_log <- map(ipc_log, ~urca::ur.df(.x, type = "trend", lags = 4))
```


**Tabla 1: Resultados del test de Dickey-Fuller aumentado (ADF): Series en logaritmo**

| Serie          | Estadístico ADF ($\tau_3$) | Valor crítico 5 % | Nivel de significancia | Conclusión      |
|---------------|--------------:|--------------:|--------------:|---------------|
| IPC            |                       -2.013 |             -3.43 |                    5 % | No estacionaria |
| IPC subyacente |                       -1.813 |             -3.43 |                    5 % | No estacionaria |
| IPC A&B        |                       -2.088 |             -3.43 |                    5 % | No estacionaria |
| IPC transporte |                       -2.624 |             -3.43 |                    5 % | No estacionaria |



*Los resultados del test de Dickey-Fuller aumentado (ADF) indican que ninguna de las series en niveles rechaza la hipótesis nula de presencia de raíz unitaria al 5 % de significancia, ver [Apéndice A](#apendice-a). En consecuencia, se concluye que las series no son estacionarias en niveles. Se procede a transformar las series mediante diferenciación de primer orden, con el objetivo de inducir estacionariedad.*

## Transformación de serie en primera diferencia

```{r}
#| echo: true
ipcs_log_diff <- map(ipc_log, diff)     # Primera diferencia de logaritmos
test_diff <- map(ipcs_log_diff, ~urca::ur.df(.x, type = "trend", lags = 4))
```


**Tabla 2: Resultados del test de Dickey-Fuller aumentado (ADF): Series con primeras diferencias**

| Serie               | Estadístico ADF ($\tau_3$) | Valor crítico 5 % | Nivel de significancia | Conclusión |
|---------------------|-------------------:|------------------:|-----------------------:|------------|
| IPC                 | -6.043             | -3.43             | 5 %                    | Estacionaria |
| IPC subyacente      | -3.902             | -3.43             | 5 %                    | Estacionaria |
| IPC A&B             | -6.406             | -3.43             | 5 %                    | Estacionaria |
| IPC transporte      | -7.654             | -3.43             | 5 %                    | Estacionaria |

*Luego de aplicar la transformación en primeras diferencias, los resultados del test ADF indican que todas las series rechazan la hipótesis nula de raíz unitaria al 5 % de significancia. En consecuencia, se concluye que las series transformadas son estacionarias. Para más detalles del test véase el Apéndice B.*

# Preparación de los datos


## Estadísticas descriptivas

**Tabla 3: Estadísticos descriptivos de las primeras diferencias logarítmicas del IPC**

| Serie               | Media  | Varianza    | Mínimo   | Máximo  |
|---------------------|-------:|------------:|---------:|--------:|
| IPC                 | 0.0038 | 0.0000308   | -0.0333  | 0.0235  |
| IPC subyacente      | 0.0034 | 0.00000575  | -0.0011  | 0.0138  |
| IPC A&B             | 0.0048 | 0.0000810   | -0.0211  | 0.0380  |
| IPC transporte      | 0.0038 | 0.0003130   | -0.1250  | 0.0641  |


## Correlaciones


**Tabla 4: Matriz de correlaciones entre las primeras diferencias logarítmicas del IPC**

|                  | IPC   | IPC subyacente | IPC A&B | IPC transporte |
|------------------|------:|---------------:|--------:|---------------:|
| IPC              | 1.000 |                |         |                |
| IPC subyacente   | 0.39  | 1.000          |         |                |
| IPC A&B          | 0.60  | 0.40           | 1.000   |                |
| IPC transporte   | 0.84  | 0.06           | 0.14    | 1.000          |


## Gráfico 4: Primeras diferencias logarítmicas del IPC

```{r}
library(lubridate)

ipcs_log_diff_longer <- map_dfr(
  ipcs_log_diff,
  ~ tibble(
    fecha = seq.Date(
      from = as.Date(paste(start(.x)[1], start(.x)[2], "01", sep = "-")),
      by   = "month",
      length.out = length(.x)
    ),
    valor = as.numeric(.x)
  ),
  .id = "variables"
)
```

```{r}
ipcs_log_diff_longer |> 
  ggplot(aes(fecha, valor, color = variables)) +
  geom_line(size = 1) +
  facet_wrap(~variables) +
  labs(
    title = "Primeras diferencias logarítmicas del IPC",
    subtitle = "República Dominicana 2006 - 2025",
    caption = "Fuente: elaboración propia con datos del BCRD"
  ) +
  scale_color_manual(values = colores) +
  theme_classic()+
  theme_conf()
```



# Identificación del Modelo ARIMA

## Gráfico 5: Función de autocorrelación simple (ACF)

```{r}
#| fig-width: 5
ipc_to_model <- ts(bind_cols(ipcs_log_diff), 
                   start = c(2006, 02), # Se elimino la primera observacion
                   frequency = 12,      # por la diferenciación
                   ) |> as_tsibble()

ipc_to_model |> 
  group_by(key) |> 
  ACF(value, lag_max = 12) |> 
  autoplot() +
  labs(x = "Rezagos", y = "ACF")
```
## Gráfico 6: Función de autocorrelación parcial (PACF)

```{r}
#| fig-width: 5
ipc_to_model |> 
  group_by(key) |> 
  PACF(value, lag_max = 12) |> 
  autoplot() +
  labs(x = "Rezagos", y = "PACF")
```


### Justificación de modelo ARMA apropiado

*El análisis de las funciones de autocorrelación (ACF) y autocorrelación parcial (PACF) de las primeras diferencias logarítmicas sugiere que las series presentan una dinámica de corto plazo dominada por la persistencia en el primer rezago. En particular, para el IPC general, IPC de alimentos y bebidas, y el IPC de transporte, la PACF muestra un corte claro en el primer rezago, mientras que la ACF decae gradualmente, lo cual es consistente con un proceso AR(1).*


# Estimación del modelo


## Resultados de la estimación

```{r}
#| echo: true
modelos_arma <- ipc_to_model |> 
  group_by(key) |> 
  model(arma11 = ARIMA(value ~ pdq(1, 0, 1)))
```

**Tabla 5: Resultados de la estimación de modelos ARMA(1,1) para las primeras diferencias logarítmicas del IPC**

| Serie           | Modelo | Log-verosimilitud | AIC     | AICc    | BIC     |
|-----------------|:------:|------------------:|--------:|--------:|--------:|
| IPC             | ARMA(1,1) | 925.00            | -1842.00 | -1842.00 | -1828.00 |
| IPC subyacente  | ARMA(1,1) | 1160.00           | -2308.00 | -2308.00 | -2287.00 |
| IPC A&B         | ARMA(1,1) | 807.00            | -1604.00 | -1604.00 | -1587.00 |
| IPC transporte  | ARMA(1,1) | 654.00            | -1295.00 | -1295.00 | -1274.00 |


## Evaluación de los modelos


### Gráfico 6: Comportamiento de los residuos

```{r}
#| fig-width: 5
residuos_modelos <- modelos_arma |> 
 augment()

residuos_modelos |>
  ggplot(aes(x = index, y = .resid)) +
  geom_line() +
  facet_wrap(~ key, scales = "free_y", ncol = 1) +
  labs(title = "Residuos de los modelos ARMA(1,1)",
    x = "Fecha",
    y = "Residuo") +
  theme_minimal()

```
### Gráfico 8: ACF de los residuos

```{r}
#| fig-width: 5
residuos_modelos |>
  group_by(key) |>
  ACF(.resid, lag_max = 12) |>
  autoplot() +
  labs(title = "ACF de los residuos de los modelos ARMA(1,1)")
```

*La función de autocorrelación (ACF) de los residuos de los modelos ARMA(1,1) no muestra patrones sistemáticos ni picos persistentes a lo largo de los rezagos considerados. En la mayoría de los casos, las autocorrelaciones se mantienen dentro de las bandas de confianza, lo que indica ausencia de dependencia serial remanente en los residuos.*


### Gráfico 9: Histograma de los residuos

```{r}
residuos_modelos |>
  ggplot(aes(x = .resid)) +
  geom_histogram(bins = 30) +
  facet_wrap(~ key, scales = "free") +
  theme_minimal() +
  labs(title = "Distribución de los residuos ARMA(1,1)")

```

*La distribución de los residuos de los modelos ARMA(1,1) muestra una forma aproximadamente simétrica y centrada en torno a cero para todas las series, lo que sugiere que el modelo captura adecuadamente la dinámica media de los datos.*

### Pruebas estadísticas


**Tabla 6: Test Ljung-Box autocorrelación en residuos**

```{r}
library(knitr)
library(kableExtra)

pruebas_lb <- modelos_arma |>
  augment() |>
  features(.resid, ljung_box, lag = 12)

kable(pruebas_lb, 
             col.names = c("Serie", "Modelo", "Estadístico Q", "p-valor"),
      digits = 3,
      align = "lccc",
      booktabs = TRUE) |> 
  kable_styling(full_width = FALSE, latex_options = "hold_position")
  
```

*La prueba de Ljung–Box aplicada a los residuos de los modelos ARMA(1,1) no rechaza la hipótesis nula de ausencia de autocorrelación hasta el rezago 12 en ninguna de las series analizadas (p-valores mayores a 0.10). Este resultado sugiere que los residuos se comportan como ruido blanco, lo que respalda la adecuada especificación de los modelos estimados.*


# Conclusión

*Los resultados muestran que las variaciones del IPC y de sus componentes pueden describirse adecuadamente mediante modelos ARMA(1,1), lo que evidencia la existencia de dependencia temporal de corto plazo en las series. El IPC subyacente presenta mayor persistencia, mientras que los componentes de A&B y transporte responden con mayor intensidad a choques transitorios. Los criterios de información confirman la idoneidad de los modelos estimados y el análisis de residuos no revela autocorrelación remanente significativa, respaldando la validez de la especificación adoptada.*

\newpage

# Apéndices


## Apéndice A: Dickey-Fuller Aumentada - series logaritmos

```{r}
#| echo: true
#| fig-align: center
map(test_log, summary)
```



## Apéndice B: Dickey-Fuller Aumentada - series primera diferencia logaritmos


```{r}
#| echo: true
#| fig-align: center
map(test_diff, summary)
```

## Apéndice C


### Apéndice C1: Estadísticos descriptivos de las primeras diferencias logarítmicas del IPC


```{r}
#| echo: true
map_dfr(
  ipcs_log_diff,
  ~tibble::tibble(
    media    = mean(.x, na.rm = TRUE),
    varianza = var(.x, na.rm = TRUE),
    minimo   = min(.x, na.rm = TRUE),
    maximo   = max(.x, na.rm = TRUE)),
  .id = "serie")
```



### Apéndice C2: Matriz de correlaciones entre las primeras diferencias logarítmicas del IPC

```{r}
#| echo: true
df_ipcs <- dplyr::bind_cols(ipcs_log_diff)

cor_mat <- cor(df_ipcs, use = "pairwise.complete.obs")
round(cor_mat, 3)
```


## Apéndice D: Resultados de la estimación de modelos ARMA(1,1)

```{r}
#| echo: true
modelos_arma |> 
  glance() |> 
  select(key, .model:BIC)
```

## Apéndice E: Test Ljung-Box autocorrelación en residuos

```{r}
#| echo: true
pruebas_lb
```
